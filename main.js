const { app, BrowserWindow, contextBridge, ipcMain, nativeImage, Menu } = require('electron')
const path = require('path')



// è¿è¡Œä¸»è¿›ç¨‹ -> åˆ›å»ºçª—å£ -> åˆ›å»ºæ¸²æŸ“è¿›ç¨‹
// è¿è¡Œåœ¨æ¸²æŸ“è¿›ç¨‹
/*
	APP çš„ç”Ÿå‘½å‘¨æœŸï¼ˆä¸æ˜¯äº‹ä»¶çš„å£°æ˜å‘¨æœŸï¼‰
		ready: app  		åˆå§‹åŒ–å®Œæˆ
		dom-ready   		çª—å£ä¸­çš„ DOM å…ƒç´ åŠ è½½å®Œæˆ
		did-finish-load  	å¯¼èˆªå®ŒæˆåŠ è½½æ—¶è§¦å‘
		window-all-closed 	æ‰€æœ‰çª—å£éƒ½è¢«å…³é—­æ—¶è§¦å‘
		before-quit 		åœ¨çª—å£å…³é—­å‰è§¦å‘
		will-quit 			åœ¨çª—å£å…³é—­å¹¶ä¸”é€€å‡ºåº”ç”¨æ—¶è§¦å‘
		quit 				æ‰€æœ‰çª—å£éƒ½è¢«å…³é—­æ—¶è§¦å‘	 
		closed				çª—å£å…³é—­åè§¦å‘
 */

// ğŸ‘‡ã€ä¸»è¿›ç¨‹ã€‘
// âœï¸ åˆ›å»ºçª—å£çš„æ–¹æ³• â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function createWin () {
	let mainWindow = new BrowserWindow({
		frame: false, //æ˜¾ç¤ºç³»ç»Ÿæ 
    	// autoHideMenuBar: false,
		x: 10,// çª—å£æ‰“å¼€çš„ä½ç½®(ç›¸å¯¹äºæ¡Œé¢å·¦ä¸Šè§’)
		y: 10, // çª—å£æ‰“å¼€çš„ä½ç½®(ç›¸å¯¹äºæ¡Œé¢å·¦ä¸‹è§’)
		show: false, //ğŸ‘€ğŸ”¥ ç­‰å†…å®¹åŠ è½½å®Œå†æ˜¾ç¤ºçª—å£, é¿å…ç™½å±
		height: 400,
		maxHeight: 1000,// è®¾ç½®çª—å£æ‹‰ä¼¸æœ€å¤§å€¼
		minHeight: 200,// è®¾ç½®çª—å£æ‹‰ä¼¸æœ€å°å€¼
		width: 600,// çª—å£å®½åº¦
		maxWidth: 1600,// è®¾ç½®çª—å£æ‹‰ä¼¸æœ€å¤§å€¼
		minWidth: 400,// è®¾ç½®çª—å£æ‹‰ä¼¸æœ€å°å€¼
		resizable: true, //å…è®¸ç¼©æ”¾çª—å£
		title: 'è‡ªå®šä¹‰åç§°-Rocket Dev',
		icon: './icon/rocket.ico',
		webPreferences: {
			nodeIntegration: true, //ğŸ‘ˆ å…è®¸æ¸²æŸ“è¿›è¡Œä½¿ç”¨ Node
			contextIsolation: false, //ğŸ‘ˆ å…è®¸æ¸²æŸ“è¿›è¡Œä½¿ç”¨ Node
			enableRemoteModule: true, //ğŸ‘ˆ å…è®¸æ¸²æŸ“è¿›è¡Œä½¿ç”¨ Node
		}
		// frame: true, //é¡¶éƒ¨çš„ç³»ç»Ÿèœå•æ 
		// autoHideMenuBar: true, //è‡ªåŠ¨éšè—èœå•æ 
		// transparent: true, //é€æ˜çª—å£(å¯ä»¥ç”¨åœ¨æ¯”å¦‚æ­Œè¯çª—å£)
	})





	// ğŸ‘‡ å¼•å…¥æ‰“å¼€ç¬¬äºŒä¸ªçª—å£çš„æ–¹æ³•(å…è®¸æ¸²æŸ“è¿›ç¨‹ä¸­ä½¿ç”¨ require æ¥å¼•å…¥ä¸»è¿›ç¨‹çš„æ¨¡å—)
	require("@electron/remote/main").initialize() // åˆå§‹åŒ–è¿œç¨‹æ¨¡å—
	require("@electron/remote/main").enable(mainWindow.webContents) // enable() æ–¹æ³•ç”¨äºå¯ç”¨æŒ‡å®š webContents å¯¹è±¡ä¸Šçš„è¿œç¨‹æ¨¡å—åŠŸèƒ½


	mainWindow.on('ready-to-show', () => {
		mainWindow.show() //ğŸ‘€ğŸ”¥ ç­‰å†…å®¹åŠ è½½å®Œåå†æ˜¾ç¤ºçª—å£(é¿å…ç™½å±)
	})

	// åœ¨å½“å‰çª—å£ä¸­åŠ è½½æŒ‡å®šçš„ç•Œé¢ (html)
	mainWindow.loadFile('index.html') //åŠ è½½æœ¬åœ° html æ–‡ä»¶

	// DOM å…ƒç´ å®ŒæˆåŠ è½½
	mainWindow.webContents.on('dom-ready', () => {
		console.log('222 --- DOM å®ŒæˆåŠ è½½')
	})

	// å¯¼èˆªå®ŒæˆåŠ è½½
	mainWindow.webContents.on('did-finish-load', () => {
		console.log('333 --- å¯¼èˆªå®ŒæˆåŠ è½½')
	})

	// çª—å£å…³é—­äº‹ä»¶
	mainWindow.on('close', () => {
		console.log('888 --- çª—å£å…³é—­äº†') //ğŸ‘ˆğŸ‘ˆå¦‚æœæœ‰å¤šä¸ªçª—å£, 888 å°±æ˜¯ä¼šåœ¨æœ€åä¸€æ­¥ï¼ï¼ï¼ å¦‚æœæ˜¯åªæœ‰ä¸€ä¸ªçª—å£å°±ä¸æ˜¯åœ¨æœ€åæ‰§è¡Œ, è€Œæ˜¯åœ¨ 333 ä¹‹å
		mainWindow = null //ğŸš€é‡Šæ”¾å†…å®¹ç©ºé—´
	})





	// ğŸ¦ è‡ªå®šä¹‰èœå• (Electron çš„ Menu ç±»è¦æ±‚èœå•æ¨¡æ¿ä¸­çš„æ¯ä¸ªèœå•é¡¹éƒ½å¿…é¡»å…·æœ‰labelã€roleæˆ–typeå±æ€§ä¸­çš„è‡³å°‘ä¸€ä¸ª)
	const template = [
		{
			label: '',
			submenu: [ //ç³»ç»Ÿèœå•
				{ role: 'about', icon: nativeImage.createFromPath('./icon/icon_cms.png').resize({ width: 16, height: 16 })}, //role éƒ½æ˜¯ electron å†…å¥½çš„é€‰é¡¹
				{ type: 'separator' },
				{ role: 'services' },
				{ type: 'separator' }, //åˆ†å‰²çº¿, type æ˜¯å†…ç½®å¥½çš„å…ƒç´ 
				{ role: 'hide' },
				{ role: 'hideOthers' },
				{ role: 'unhide' },
				{ type: 'separator' },
				{ role: 'quit' },
			],
		},
		{
			label: 'æ–‡ä»¶', // label ä¸ºèœå•åç§°
        	submenu: [
				{
					label: 'æ‰“å¼€æ–‡ä»¶' , // label ä¸ºèœå•åç§°
					accelerator: 'CmdOrCtrl+N', //å¿«æ·é”®
					click: () => {
						console.log('æ‰“å¼€äº†æ–‡ä»¶')
						console.log(process.platform) // æŸ¥çœ‹æ“ä½œç³»ç»Ÿ darwin ä¸ºæ“ä½œç³»ç»Ÿ
					}
				},
			],
		},
		{
			label: 'ç¼–è¾‘',
			submenu: [
				{ label: 'å–æ¶ˆ', role: 'undo' },
				{ label: 'é‡åš', role:'redo' },
				{ type: 'separator' }, //åˆ†å‰²çº¿
				{ label: 'å‰ªåˆ‡', role: 'cut' },
				{ label: 'å¤åˆ¶', role: 'copy' },
				{ label: 'ç²˜è´´', role: 'paste' },
			],
		},
		{
			label: 'ç±»å‹',
			submenu: [
				{ label: 'é€‰é¡¹ 1', type: 'checkbox', click: () => { console.log('é€‰é¡¹ 1') } },
				{ label: 'é€‰é¡¹ 2', type: 'checkbox', click: () => { console.log('é€‰é¡¹ 2') } },
				{ label: 'é€‰é¡¹ 3', type: 'checkbox', click: () => { console.log('é€‰é¡¹ 3') } },
				{ type: 'separator' },
				{ label: 'item 1', type: 'radio', click: () => { console.log('item 1') } },
				{ label: 'item 2', type: 'radio', click: () => { console.log('item 2') } },
				{ label: 'item 3', type: 'radio', click: () => { console.log('item 3') } },
				{ type: 'separator' },
				{ label: 'ä¸€ä¸ªçº§èœå•', type: 'submenu', role: 'windowMenu'}, //ğŸš€äºŒçº§èœå•
				{ label: 'å¦ä¸€ä¸ªèœå•', type: 'submenu', //ğŸš€äºŒçº§èœå•
					submenu: [
						{ label: 'é€‰é¡¹ 1', accelerator: 'CmdOrCtrl+1', type: 'checkbox', click: () => { console.log('é€‰é¡¹ 1') } },
						{ label: 'é€‰é¡¹ 2', type: 'checkbox', click: () => { console.log('é€‰é¡¹ 2') } },
						{ label: 'é€‰é¡¹ 3', type: 'checkbox', click: () => { console.log('é€‰é¡¹ 3') } },
				]},
			]
		},
		{
			label: 'è§†å›¾',
			submenu: [
				{ label: 'é‡æ–°åŠ è½½', role: 'reload' },
				{ label: 'å¼ºåˆ¶é‡æ–°åŠ è½½', role: 'forceReload' },
				{ label: 'æ‰“å¼€å¼€å‘è€…å·¥å…·', role: 'toggleDevTools' },
				{ label: 'dev', click: () => {		
					const win = BrowserWindow.getFocusedWindow() //ğŸ”¥ getFocusedWindow æ‰¾åˆ°å½“å‰æ­£åœ¨è¿›è¡Œçš„æ¸²æŸ“è¿›ç¨‹
					win.webContents.openDevTools() //ğŸ”¥ webContents æ‹¿åˆ°æ¸²æŸ“è¿›ç¨‹çš„æ‰€æœ‰å†…å®¹
				}},
				{ type: 'separator' },
				{ label: 'é‡åˆ¶è§†å›¾', role: 'resetZoom' },
				{ label: 'æ”¾å¤§', role: 'zoomIn' },
				{ label: 'ç¼©å°', role: 'zoomOut' },
				{ type: 'separator' }, //åˆ†å‰²çº¿
			],
			accelerator: 'CmdOrCtrl+Shift+I',
		},
		{
			label: 'ç»™æ¸²æŸ“è¿›ç¨‹å‘é€æ¶ˆæ¯',
			submenu: [
				{ label: 'å‘é€æ¶ˆæ¯', click: () => {
						BrowserWindow.getFocusedWindow().send('mtp', 'ğŸš€ æˆ‘æ˜¯ä¸»è¿›ç¨‹å‘é€çš„æ¶ˆæ¯-2')
					}
				}
			]	
		}
	]
	const menu = Menu.buildFromTemplate(template)
	Menu.setApplicationMenu(menu)
}




// âš¡ï¸ åˆå§‹åŒ–å®Œæˆå, åˆ›å»ºçª—å£ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
app.on('ready', () => { 
	console.log('111 --- çª—å£è¢«åˆ›å»º')
	createWin() //ğŸ‘†è°ƒç”¨åˆ›å»ºçª—å£çš„å‡½æ•°
}) 



// âŒ çª—å£éƒ½å…³é—­åçš„äº‹ä»¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
app.on('window-all-closed', () => { //ğŸ”¥å¦‚æœæœ‰è¿™ä¸ªäº‹ä»¶, å°±éœ€è¦æ‰‹åŠ¨çš„å†™ä¸Š app.quit() !!! ä¸ç„¶ 555ã€666ã€777 éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼ 
	console.log('444 --- æ‰€æœ‰çª—å£éƒ½å…³é—­äº†')
	// app.quit() //é€€å‡º app
	// Mac å¹³å°ä¸‹éšè—åœ¨åº•éƒ¨å·¥å…·æ 
	const macOS = process.platform === 'darwin'
	if (!macOS) {
		app.quit()
	} else {
		// éšè—åº•éƒ¨å·¥å…·æ 
		app.dock.hide()
	}
	
})


// ğŸ‘€ çª—å£å…³é—­å‰çš„äº‹ä»¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
app.on('before-quit', () => {
	console.log('555 --- çª—å£å…³é—­å‰')
	// app.quit() //é€€å‡º app
})


// ğŸ§Š çª—å£å³å°†å…³é—­äº‹ä»¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
app.on('will-quit', () => {
	console.log('666 --- çª—å£å³å°†å…³é—­')
	// app.quit() //é€€å‡º app
})


// âš ï¸ çª—å£å…³é—­æ—¶äº‹ä»¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
app.on('quit', () => {
	console.log('666 --- çª—å£å…³é—­æ—¶')
	// app.quit() //é€€å‡º app
})



// ğŸš€ ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹çš„é€šè®¯ã€‘ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ipcMain.on('msg', (e, data) => { 
	console.log(data) // æ¥æ”¶æ¸²æŸ“è¿›ç¨‹å‘æ¥çš„å¼‚æ­¥æ¶ˆæ¯ data

	// å¾€æ¸²æŸ“è¿›ç¨‹å‘é€æ¶ˆæ¯
	e.sender.send('reply', 'æˆ‘æ˜¯ä¸»è¿›ç¨‹å‘æ¥çš„å¼‚æ­¥æ¶ˆæ¯')
})


ipcMain.on('msg2', (e, data) => {
	console.log(data) // æ¥æ”¶æ¸²æŸ“è¿›ç¨‹å‘æ¥çš„åŒæ­¥æ¶ˆæ¯ data

	e.returnValue = 'æˆ‘æ˜¯ä¸»è¿›ç¨‹å‘æ¥çš„åŒæ­¥æ¶ˆæ¯'
})


